% vim: ts=4 sts=4 sw=4 et tw=75

\documentclass[nofonts, oneside]{ctexbook}

\usepackage{geometry}
\usepackage{fontspec}
\usepackage{xeCJK}
\usepackage{amssymb}
\usepackage{hyperref}
% for number of footnote
\usepackage{pifont}
% 一页结束时, 脚注编号清零
\usepackage[perpage]{footmisc}
% verbatim and endverbatim
\usepackage{graphicx}
\usepackage{listings}
\usepackage{multicol}
\usepackage{tocloft}
\usepackage{listings}

% 脚注编号带圈
\renewcommand\thefootnote{\ding{\numexpr171+\value{footnote}}}

% from package geometry
% 为边注加边框
\let\oldmarginpar=\marginpar
\renewcommand\marginpar[1]{%
    \oldmarginpar{\framebox{#1}}%
}
\geometry{%
    margin=1cm,
    marginparsep = 0.5cm,
    marginparwidth=1cm,
    top = 2.5cm,
    bottom = 2cm,
    outer = 1.8cm,
    inner = 1.8cm
}

% from package hyperref
\hypersetup{
    bookmarksnumbered = true,
    pdftitle = {The UNIX Programming Environment},
    pdfcreator = {wuzhouhui250@gmail.com},
    pdfauthor = {Brian W. Kernighan, Rob Pike},
    pdfsubject = {UNIX},
    colorlinks = false,
    pdfborder = 0 0 0,
    pdfkeywords = {Operating System, UNIX}
}

\setCJKfamilyfont{heiti}{FandolHei}
% 章节格式
\CTEXsetup[format={\CJKfamily{heiti}\large\upshape}]{subsection}
\CTEXsetup[numberformat={\CJKfamily{heiti}\large\upshape\bfseries}]{subsection}
\CTEXsetup[format={\CJKfamily{heiti}}]{subsubsection}
% 目录格式
\renewcommand\cftchapfont{\CJKfamily{heiti}}
\settowidth\cftchapnumwidth{第几十几章} % 最宽的可能编号
\renewcommand\cftchapaftersnumb{\hspace{2.2em}} % 额外间距

% 术语
\newcommand\upeterm[1]{{\CJKfamily{heiti}{#1}}}
% 控制字符记法
\newcommand\upectl[1]{\textit{ctl}-\texttt{#1}}

% from package fontspec and xeCJK
\setCJKmainfont{AR PL UMing CN}
\setCJKsansfont{AR PL UMing CN}
\setCJKmonofont[Scale=0.9]{AR PL UMing CN}
\setmainfont{FreeSerif}
\setsansfont{FreeSans}
% "Mapping={}" make quote symbol straight
\setmonofont[Mapping={}]{FreeMono}

% input of user
\newcommand\upein[1]{\textit{\texttt{#1}}}
% arguments of command
\newcommand\upearg[1]{\textit{\textrm{#1}}}
% explanation
\newcommand\upeexp[1]{\textit{\textrm{#1}}}
% shell 环境
% FIXME: 注解对齐
\lstnewenvironment{upeshell}
    {
	\lstset{
		basicstyle = \ttfamily,
		tabsize = 8,
		escapeinside={\^\^},
	}
    }
    {}

\title{UNIX 编程环境}
\author{Brian W. Kernighan
    \and Rob Pike
    \and \url{https://github.com/wuzhouhui/upe}
}
