\chapter{入门}
\label{chap:unix_for_beginners}
\marginpar{1}

什么是 UNIX? 从狭义上来说, 它是一个分时操作系统内核. 内核是一种计算机程序,
用于控制计算机资源, 并将其分配给用户. 有了内核, 用户就可以运行他们自己的程序;
内核控制着连接到主机上的外围设备 (磁盘, 终端, 打印机等); 内核还提供了一
个文件系统, 用于管理需要长期存放的数据, 比如程序, 文档.

从广义上来说, 除了内核, UNIX 还必须包含一系列必要的应用程序, 比如编译器, 编辑
器, 命令语言, 文件复制与打印程序等.

再说得宽泛些, UNIX 甚至还可以包括由用户自己开发的, 可以在系统中运行的程序,
比如文档展示工具, 统计分析工具, 和图形图像软件包等.

如何恰当地使用这些 UNIX 概念, 取决于读者所考虑的系统层面. 在本书中, 当我们提到
UNIX 时, 其上下文语境足以指明它的具体含义.

有时候, UNIX 系统可能比看起来更加难以使用 --- 初学者很难知道如何以最高的效率
使用 UNIX. 但幸运的是, 入门并不是很困难 --- 通过对几个简单的工具的了解, 读者
就可以马上开始使用 UNIX 系统. 这一章的目标是帮助读者尽可能快得开始使用 UNIX.
本章只是一个概览, 而非手册, 我们会在后面的章节再详细地介绍本章提到的大部分内
容. 本章介绍的内容有:

\begin{itemize}
    \item 基础 --- 登录与注销, 简单的命令, 纠正打字错误, 邮件, 终端间通信.
    \item 日常使用 --- 文件与文件系统, 打印文件, 目录, 常用命令.
    \item 命令解释器 (shell) --- 文件命简写, 输入与输出重定向, 管道, 设置
        擦除与终止字符, 定义命令搜索路径.
\end{itemize}
  
如果读者曾经使用过 UNIX 系统, 那么本章的大部分内容都会感到很熟悉, 此时读者可
以直接从第 \ref{chap:the_file_system} 章开始阅读.

\marginpar{2}
即使是在阅读这一章, 读者也需要准备一份 \textit{UNIX Programmer's Manual},
与其在书中重复手册的内容, 还不如让读者自己去阅读手册来得方便. 本书的目标并
非取代手册, 而是向读者展示如何有效地使用手册中所介绍的命令. 另外, 我们介绍
的内容可能与读者所用的系统稍有不同. 手册的开头有一份排序了的索引, 通过该索引
读者可以快速地找到自己想要的程序.

最后提个建议: 不要害怕实验. 对于初学者来说, 不太可能出现一些能够伤害到他人
或自己的意外, 所以请通过实践来学习书中的内容. 这一章很长, 最好的方式是每次
只阅读几页, 然后在自己的系统中尝试一遍.

\section{开始}
\label{sec:getting_started}

\subsection{终端与键盘输入的一些必要条件}
\label{subsec:some_prerequisites_about_terminals_and_typing}

为了避免解释计算机操作过程中的方方面面, 我们假设读者已经具备了计算机终端的
基础知识, 并且知道如何使用它们, 如何读者对下面的内容感到疑惑, 请咨询相应地
专家.

UNIX 工作在 \upeterm{全双工} (full duplex) 模式下, 也就是说用户通过键盘按下
的字符会被发送到系统中, 而系统也会把这些字符发送到终端上, 从而显示在屏幕中.
通常情况下, 这个 \upeterm{回显} (echo) 过程只是把字符直接复制到屏幕上, 但
是有时候, 比如用户在输入密码, 此时用户输入的字符就不会出现在屏幕上.

键盘上的大多数字符都是普通的可打印字符, 它们本身没有特殊的意义. 少数字符会
告诉计算机如何解释用户的输入, 其中最重要的是 RETURN 键. RETURN 键宣告一行
输入的结束, 然后系统通过把终端的光标移动到下一行的开始来回显刚输入的那行数据.
为了让系统解释用户输入的字符, 必须先按下 RETURN 键.

RETURN 键属于 \upeterm{控制字符} (control character). 控制字符是一种不可见的字
符, 它们可以控制终端输入与输出的某些行为. 在一台设置合理的终端上, RETURN
拥有一个属于自己的独立按键, 但是其他大多数控制字符就没有这种待遇, 作为替代,
在输入它们之前要先按下 CONTROL 键 (除了 CONTROL, 还可以叫作 CTL,
CNTL 或 CTRL), 然后再按下另一个按键, 通常是一个英文字母. 例如, RETURN 既可以通过
按 RETURN 键输入, 也可以通过先按下 CONTROL 键, 再按下 \texttt{m} 来输入. 因此,
RETURN
也可以称为 control-m, 写作 \upectl{m}. 其他的控制字符包括 \upectl{d} ---
通知程序输入已结束; \upectl{g} --- 通知终端响铃; \upectl{h}, 也叫退格键,
\marginpar{3}
可以用来纠正打字错误; \upectl{i}, 经常叫作制表符, 它把光标移动到下一个制表停
止位, 打字机用得比较多. 在 UNIX 系统中, 制表停止位之间相隔 8 个空格. 退格符
与制表符在终端上都有相应的按键.

另外两个具有特殊含义的按键是 DELETE (有时候也叫作 RUBOUT, 或其他一些简写形式)
与 BREAK (有时候也叫作 INTERRUPT). 在大多数 UNIX 系统中, DELETE 会马上停止
程序, 而不用等它运行结束, 有些系统通过 \upectl{c} 完成这个功能. 还有些系统,
根据终端的连接方式, BREAK 其实就是 DELETE 或 \upectl{c} 的同义词.

\subsection{一次 UNIX 会话}
\label{subsec:a_session_with_unix}

接下来, 我们将以一次用户同 UNIX 系统之间的对话作为开始, 为了方便, 对话中会加入
注解. 对于书中的全部例子, 用户输入的内容用等宽斜体表示, 系统的输出信息用等宽
字体, 注解用斜体.

\begin{upeshell}
^\upeexp{Establish a connection: dial a phone or turn on a switch as necessary.}^
^\upeexp{Your system should say}^
login: ^\upein{you}^		^\upeexp{Type your name, then press RETURN}^
Password:		^\upeexp{Your password won't be echoed as you type it}^
You have mail.		^\upeexp{There's mail to be read after you log in}^
$			^\upeexp{The system is now ready for your commands}^
$			^\upeexp{Press RETURN a couple of times}^
$ ^\upein{date}^			^\upeexp{What is the date and time?}^
Sun Sep 25 23:02:57 EDT 1983
$ ^\upein{who}^			^\upeexp{Who's using the computer?}^
jlb      tty0    Sep 25 13:59
you      tty2    Sep 25 23:01
mary     tty4    Sep 25 19:03
doug     tty5    Sep 25 19:22
egb      tty7    Sep 25 17:17
bob      tty8    Sep 25 20:48
$ ^\upein{mail}^			^\upeexp{Read your mail}^
From doug Sun Sep 25 20:53 EDT 1983
give me a call sometime monday

?			^\upeexp{RETURN moves on to the next message}^
From mary Sun Sep 25 19:07 EDT 1983	^\upeexp{Next message}^

? ^\upein{d}^		^\upeexp{Delete this message}^
$			^\upeexp{No more mail}^
$ ^\upein{mail mary}^		^\upeexp{Send mail to mary}^
lunch at 12 is fine
^\textrm{\textit{ctl}}\upein{-d}^			^\upeexp{End of mail}^
$			^\upeexp{Hang up phone or turn off terminal}^
			^\upeexp{and that's the end}^
\end{upeshell}
有时候, 这就是一次会话的全部内容, 当然, 用户可能还会做一些其他工作.
\marginpar{4}
本节的剩下部分会对上面的会话进行详细解释, 除此之外, 还将介绍几个能完成
实际工作的程序.

\subsection{登录}
\label{subsec:logging_in}

为了登录系统, 读者须向系统管理员申请用户名与密码. UNIX 支持多种终端, 但最
好是支持小写字母, 并区分大小写的终端. 如果读者的终端只支持大写字母 (比如
视频和可移植终端), 那么操作起来将会非常麻烦, 最好换一个终端.

在登录之前要确认设备的电路开关已经设置妥当: 区分大小写, 全双工, 以及管理员
建议的其他设置, 比如 \upeterm{波特率}. 尽你的一切所能为终端建立一个连接,
这中间可能还会涉及到拨号和翻转开关等操作. 无论如何, 系统最终应该输出:
\begin{upeshell}
login:
\end{upeshell}
如果输出了垃圾信息, 那可能是波特率设置得有误, 检查一下波特率和其他开关. 如果
还不行, 就缓慢地按几下 BREAK 和 INTERRUPT. 如果还是看不到登录信息, 就向管理
员寻求帮助.

看到 \texttt{login:} 后, 输入用户名, 再按下 RETURN. 如果还需要密码, 系统就
会要求用户输入密码, 在输入密码的过程中, 回显被关闭.

登录完成后将会看到 \upeterm{命令提示符} (prompt), 命令提示符通常就是一个字
符, 表示系统现在已经准备好接收用户的输入. 最常用作提示符的字符是美元符
\verb'$' 和百分号 \verb'%', 不过用户可以把提示符设置成任意内容, 稍后我们就
会介绍如何设置. 实际上, 打印提示符的是一个程序, 这个程序叫作
\upeterm{命令解释器} (command interpreter) 或 \textit{shell}, 它是用户同
系统交互的主要接口.

在提示符之前, 可能还会看到日期, 或者是通知用户有邮件未读. 系统可能还会询问
终端的类型, 用户的回答可以帮助系统设置终端的属性.

\subsection{键入命令}
\label{subsec:typing_commands}

看到提示符后就可以键入 \upeterm{命令} (command), 通过命令, 用户可以请求系统
做一些工作. 我们将使用 \upeterm{程序} (program) 作为命令的同义词. 看到提示
符 (假设提示符就是 \verb'$') 后, 键入 \texttt{date}, 再按下 RETURN, 系统就会
打印当前的日期和时间, 然后是另一个提示符. 在终端中, 整个事务的过程就像下面
这样:
\begin{upeshell}
$ ^\upein{date}^
Mon Sep 26 12:20:57 EDT 1983
\end{upeshell}
不要忘记 RETURN, 也不要键入 \verb'$'. 如果用户觉得自己被系统忽略了,
\marginpar{5}
就按下 RETURN, 这时应该会有所变化. 在后面的内容中我们不再提及 RETURN,
但是用户要记得每输完一行后, 都要按下 RETURN.

下一个要介绍的命令是 \texttt{who}, 它会打印当前已登录的所有用户:
\begin{upeshell}
$ ^\upein{who}^
rlm	tty0	Sep 26 11:17
pjw	tty4	Sep 26 11:30
gerard	tty7	Sep 26 10:27
mark	tty9	Sep 26 07:59
you	ttya	Sep 26 12:20
\end{upeshell}
第 1 列是用户名, 第 2 列是用户所使用的连接在系统中的名字 (tty 表示 teletype,
是 terminal 的同义词), 剩下的内容是登录时间. 读者可以试一下:
\begin{upeshell}
$ ^\upein{who am i}^
you	ttya	Sep 26 12:20
$
\end{upeshell}

如果用户输错了命令的名字, 而错误的名字引用了一个不存在的命令, 那么系统就
会告知用户找不到对应的命令:
\begin{upeshell}
$ ^\upein{whom}^			^\upeexp{Misspelled command name}^
whom: not found			^\upeexp{So system didn't know how to run it}^
$
\end{upeshell}
当然, 如果用户不小心输入了另一个命令的名字, 那么命令也会正常执行, 只不过执行
结果可能跟想像中的不一样.

\subsection{奇怪的终端行为}
\label{subsec:strange_terminal_behavior}

有时候终端的表现可能会有异常, 比如每一个字符都显示两次, 又或者是 RETURN
没有把光标移动到下一行的第一列. 这些问题通常可以通过关闭再打开终端, 或注销
后再登录来解决, 另一种办法是阅读手册第 1 节中, 关于命令 \texttt{stty} (set
terminal options) 的介绍. 如果用户的终端没有制表符, 为了能让它恰当地处理
制表符, 键入:
\begin{upeshell}
$ ^\upein{stty -tabs}^
\end{upeshell}
之后系统就会自动地把制表符转换成对应个数的空格. 如果用户的终端支持计算机可
配置的制表停止位, 命令 \texttt{tabs} 就可以帮你完成停止位的设置:
\begin{upeshell}
$ ^\upein{tabs}^ ^\upearg{terminal-type}^
\end{upeshell}
阅读手册以获取命令 \texttt{tabs} 的使用方法.

\subsection{纠正拼写错误}
\label{subsec:mistakes_in_typing}

如果用户在按下 RETURN 之前发现自己的输入有误, 这时候有两种解决办法: 一个一个
地擦除 (erase) 字符, 或者是删除 (kill) 一整行, 然后重新输入.

如果用户输入了 \upeterm{删行} (line kill) 字符 (默认是 \verb'@'), 那么整行
都会被丢弃, 然后在新的一行开始:
\begin{upeshell}
$ ^\upein{ddtae@}^	^\upeexp{Completely botched; start over on a new line}^
^\upein{date}^
Mon Sep 26 12:23:39 EDT 1983
$
\end{upeshell}

符号 \verb'#' 擦除最后一次输入的字符, 每一个 \verb'#' 都可以擦除一个对应的字
符. 如果用户输入的命令含有错误, 可以通过插入 \verb'#' 来纠正:
\begin{upeshell}
$ ^\upein{dd\#atte\#\#e}^		^\upeexp{Fix it as you go}^
Mon Sep 26 12:23:39 EDT 1983
$
\end{upeshell}

擦除和删行字符非常依赖于系统. 许多系统 (包括我们现在用的) 把擦除符改为退格
键, 它在视频终端中工作地非常好. 用户可以用下面的方法来判断系统用的是擦除符
还是退格键:
\begin{upeshell}
$ ^\upein{datee\textleftarrow}^	^\upeexp{Try \textleftarrow}^
$ datee\textleftarrow: not found ^\upeexp{It's not \textleftarrow}^
$ ^\upein{datee\#}^		^\upeexp{Try \#}^
Mon Sep 26 12:26:08 EDT 1983	^\upeexp{It is \#}^
$
\end{upeshell}
(我们把退格键打印成 \textleftarrow, 这样读者就可以看到它们.) 另一种删除整行
的办法是 \upectl{u}.

因为 \verb'#' 是可打印字符, 所以在这节的剩下内容里, 我们将使用 \verb'#'
作为擦除字符, 如果读者的系统与我们不同, 就在键入时作相应的修改. 如果想输入
字面上的 \verb'#' 与 \verb'@', 键入 \verb'\#' 与 \verb'\@'. 输入 \verb'@'
后, 即使有前导的 \verb'\', 系统也有可能把终端的光标移动到下一行, 不用担心,
这时候系统已经读取到了 \verb'@'.

反斜杠, 有时候也称为 \upeterm{转义字符} (escape character), 被广泛地应用在
需要特殊对待下一个字符的场合中. 为了擦除一个反斜杠, 用户需要输入两个擦除字
符: \verb'\##'.

用户输入的字符在到达目的地之前, 会被一系列程序检查和解释. 解释的方式不仅取
\marginpar{6}
决于输入字符的目的地, 还和到达的方式有关.
